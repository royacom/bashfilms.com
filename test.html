<style>
  .modal-dialog.modal-xl {
    width: 950px;
    max-width: 95%;
  }

  .pricing-modal-header {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    color: white;
    padding: 25px 30px;
    border-radius: 12px 12px 0 0;
    border: none;
  }

  .pricing-modal-header .close {
    color: white;
    opacity: 0.8;
    font-size: 32px;
    font-weight: 300;
  }

  .pricing-modal-header .close:hover {
    opacity: 1;
  }

  .pricing-modal-header h4 {
    margin: 0 0 5px 0;
    font-size: 24px;
    font-weight: 600;
  }

  .pricing-modal-header p {
    margin: 0;
    opacity: 0.85;
    font-size: 14px;
  }

  .pricing-modal-body {
    padding: 30px;
    background-color: #f8f9fa;
  }

  .info-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }

  .info-card h5 {
    margin: 0 0 15px 0;
    font-size: 16px;
    font-weight: 600;
    color: #1a1a1a;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 10px;
  }

  .form-group-readonly {
    margin-bottom: 15px;
  }

  .form-group-readonly:last-child {
    margin-bottom: 0;
  }

  .info-card .row {
    margin-bottom: 15px;
  }

  .info-card .row:last-child {
    margin-bottom: 0;
  }

  .form-group-readonly label {
    display: block;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #6c757d;
    margin-bottom: 5px;
    font-weight: 600;
  }

  .form-group-readonly .form-control {
    background-color: #f5f5f5;
    border: 1px solid #e0e0e0;
    color: #333;
    font-size: 14px;
    cursor: default;
  }

  .form-group-readonly textarea.form-control {
    font-family: 'Courier New', monospace;
    font-size: 13px;
    line-height: 1.6;
    resize: none;
    min-height: 320px;
  }

  .pricing-modal-footer {
    padding: 20px 30px;
    background-color: white;
    border-top: 1px solid #e9ecef;
    border-radius: 0 0 12px 12px;
  }

  .pricing-modal-footer .btn {
    padding: 10px 24px;
    font-size: 15px;
    font-weight: 500;
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .pricing-modal-footer .btn-primary {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    border: none;
  }

  .pricing-modal-footer .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
  }

  .pricing-modal-footer .btn-primary:disabled {
    background: #6c757d;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  @media (max-width: 768px) {
    .modal-dialog.modal-lg {
      width: 95%;
      margin: 10px auto;
    }

    .pricing-modal-body {
      padding: 20px;
    }
  }
</style>

<div
  class="modal fade"
  id="pricingCalcModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="pricingModalLabel"
>
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content" style="border-radius: 12px; border: none; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
      <div class="modal-header pricing-modal-header">
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="pricingModalLabel">Review Your Quote Request</h4>
        <p>Please review your information before submitting</p>
      </div>

      <form id="pricingForm" method="POST" action="/submit-quote">
        <div class="modal-body pricing-modal-body">
          <!-- Contact Information Card -->
          <div class="info-card">
            <h5>Contact Information</h5>
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group-readonly">
                  <label>Name</label>
                  <input type="text" name="name" class="form-control" readonly>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group-readonly">
                  <label>Email</label>
                  <input type="email" name="email" class="form-control" readonly>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group-readonly">
                  <label>Phone</label>
                  <input type="text" name="photo" class="form-control" readonly>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group-readonly">
                  <label>Event Title</label>
                  <input type="text" name="eventTitle" class="form-control" readonly>
                </div>
              </div>
            </div>
            <div class="form-group-readonly">
              <label>Event URL</label>
              <input type="text" name="eventURL" class="form-control" readonly>
            </div>
          </div>

          <!-- Event Details Card -->
          <div class="info-card">
            <h5>Event Details</h5>
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group-readonly">
                  <label>Start Date</label>
                  <input type="text" name="startDate" class="form-control" readonly>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group-readonly">
                  <label>Location</label>
                  <input type="text" name="location" class="form-control" readonly>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-4">
                <div class="form-group-readonly">
                  <label>Days</label>
                  <input type="text" name="days" class="form-control" readonly>
                </div>
              </div>
              <div class="col-sm-4">
                <div class="form-group-readonly">
                  <label>Rooms</label>
                  <input type="text" name="rooms" class="form-control" readonly>
                </div>
              </div>
              <div class="col-sm-4">
                <div class="form-group-readonly">
                  <label>Turnaround</label>
                  <input type="text" name="turnaround" class="form-control" readonly>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group-readonly">
                  <label>Hotel Accommodations</label>
                  <input type="text" name="hotel" class="form-control" readonly>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group-readonly">
                  <label>Meals</label>
                  <input type="text" name="meals" class="form-control" readonly>
                </div>
              </div>
            </div>
          </div>

          <!-- Pricing Card -->
          <div class="info-card">
            <h5>Estimated Price</h5>
            <div class="form-group-readonly">
              <input type="text" name="price" class="form-control" readonly style="font-size: 24px; font-weight: 600; text-align: center; color: #007bff; background-color: #f0f8ff;">
            </div>
          </div>

          <!-- Notes Card (if any) -->
          <div class="info-card" id="notesCard" style="display: none;">
            <h5>Additional Notes</h5>
            <div class="form-group-readonly">
              <textarea name="notes" class="form-control" readonly style="min-height: 100px;"></textarea>
            </div>
          </div>

          <!-- Hidden field for complete email message -->
          <input type="hidden" name="message">
        </div>

        <div class="modal-footer pricing-modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" id="submitQuoteBtn">
            ‚úì Confirm &amp; Send Quote Request
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// AJAX Form Submission Handler
$(document).ready(function() {
  $('#pricingForm').on('submit', function(e) {
    e.preventDefault();

    const $submitBtn = $('#submitQuoteBtn');
    const originalText = $submitBtn.html();

    // Show loading state
    $submitBtn.prop('disabled', true).html('‚è≥ Sending...');

    // Get form data
    const formData = {
      name: $('input[name="name"]').val(),
      email: $('input[name="email"]').val(),
      phone: $('input[name="photo"]').val(),
      message: $('textarea[name="message"]').val()
    };

    console.log('üì§ Submitting quote:', formData);

    // AJAX submission
    $.ajax({
      url: $(this).attr('action'),
      method: 'POST',
      data: formData,
      dataType: 'json',
      success: function(response) {
        console.log('‚úÖ Quote submitted successfully:', response);

        // Close modal
        $('#pricingCalcModal').modal('hide');

        // Reset form
        $('#pricingForm')[0].reset();
        $submitBtn.prop('disabled', false).html(originalText);

        // Send success message back to iframe
        const iframeOrigin = 'https://nextjs-boilerplate-rosy-chi-59.vercel.app';
        $('iframe').each(function() {
          try {
            this.contentWindow.postMessage({
              type: 'QUOTE_SUBMITTED_SUCCESS',
              message: 'Thank you! Your quote request has been sent successfully.'
            }, iframeOrigin);
            console.log('‚úÖ Success message sent to iframe');
          } catch (err) {
            console.warn('‚ö†Ô∏è Could not send message to iframe:', err);
          }
        });
      },
      error: function(xhr, status, error) {
        console.error('‚ùå Error submitting quote:', error);
        alert('There was an error submitting your quote. Please try again or contact us directly.');
        $submitBtn.prop('disabled', false).html(originalText);
      }
    });
  });

  // Reset form when modal closes
  $('#pricingCalcModal').on('hidden.bs.modal', function() {
    $('#pricingForm')[0].reset();
    $('#submitQuoteBtn').prop('disabled', false).html('‚úì Confirm &amp; Send Quote Request');
  });
});
</script>
